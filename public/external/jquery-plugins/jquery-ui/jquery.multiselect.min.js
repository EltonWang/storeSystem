(function(e){var t=0;e.widget("dr.multiselect",{options:{header:true,maxHeight:260,iconWidth:25,classes:"multiselect",checkAllText:"Select all",uncheckAllText:"Select none",noneSelectedText:"Select ",selectedText:"# selected",selectedList:0,show:"",hide:"",autoOpen:false,multiple:true,position:{}},_create:function(){var i=this,a=this.element,s=this.options,r=[],n=[],o=a.attr("title"),l=a.attr("class"),d=a.attr("id")||t++;this.speed=e.fx.speeds._default;this._isOpen=false;r.push('<button type="button" class="ui-multiselect ui-widget ui-state-default');if(s.classes.length){r.push(" "+s.classes)}r.push('"');if(o.length){r.push(' title="'+o+'"');s.noneSelectedText+=o;s.checkAllText+=" "+o}else{s.noneSelectedText+="options";s.checkAllText+=" options"}r.push("><span>"+s.noneSelectedText+"</span></button>");r.push('<div class="ui-multiselect-menu ui-widget ui-widget-content ui-corner-all '+(s.classes.length?s.classes:"")+'">');r.push('<ul class="ui-multiselect-checkboxes ui-helper-reset">');if(s.header===true&&s.multiple){r.push('<li class="ui-multiselect-all"><label class="ui-corner-all ui-multiselect-all" for="ui-multiselect-'+d+'-all" style=""><input id="ui-multiselect-'+d+'-all" name="ui-multiselect-all" type="checkbox" title="Check All" />'+s.checkAllText+"</label></li>")}else if(typeof s.header==="string"){r.push("<li>"+s.header+"</li>")}a.find("option").each(function(t){var i=e(this),a=i.html(),o=this.value,l=this.id||"ui-multiselect-"+d+"-option-"+t,c=i.parent(),u=i.is(":disabled"),h=["ui-corner-all"];if(c.is("optgroup")){var f=c.attr("label");if(e.inArray(f,n)===-1){r.push('<li class="ui-multiselect-optgroup-label"><a href="#">'+f+"</a></li>");n.push(f)}}if(o.length>0){if(u){h.push("ui-state-disabled")}r.push('<li class="'+(u?"ui-multiselect-disabled":"")+'">');r.push('<label for="'+l+'" class="'+h.join(" ")+'"><input id="'+l+'" name="multiselect_'+d+'" type="'+(s.multiple?"checkbox":"radio")+'" value="'+o+'" title="'+a+'"');if(i.is(":selected")){r.push(' checked="checked"')}if(u){r.push(' disabled="disabled"')}r.push(" />"+a+"</label></li>")}});r.push("</ul></div>");this.button=a.hide().after(r.join("")).next("button");this.menu=this.button.next("div.ui-multiselect-menu");this.labels=this.menu.find("label");this.buttonlabel=this.button.find("span").eq(-1);this.button.addClass(l);this.menu.addClass(l);this._setWidths();this._bindEvents();this.button[0].defaultValue=this.update()},_init:function(){if(!this.options.header){this.menu.find("div.ui-multiselect-header").hide()}if(this.options.autoOpen){this.open()}if(this.element.is(":disabled")){this.disable()}},_bindEvents:function(){var t=this,i=this.button;function a(e){t[t._isOpen?"close":"open"]();return false}i.find("span").bind("click.multiselect",a);i.bind({click:a,keypress:function(e){switch(e.keyCode){case 32:t[t._isOpen?"close":"open"](e);break;case 27:case 38:case 37:t.close();break;case 39:case 40:t.open(e);break}},mouseenter:function(){if(!i.hasClass("ui-state-disabled")){e(this).addClass("ui-state-hover")}},mouseleave:function(){e(this).removeClass("ui-state-hover")},focus:function(){if(!i.hasClass("ui-state-disabled")){e(this).addClass("ui-state-focus")}},blur:function(){e(this).removeClass("ui-state-focus")}});this.menu.find("label.ui-multiselect-all").bind("click.multiselect",function(i){t[e(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"]();e(this).toggleClass("ui-multiselect-all");i.preventDefault()}).end().find("li.ui-multiselect-optgroup-label a").bind("click.multiselect",function(i){var a=e(this),s=a.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible:not(:disabled)");t._toggleChecked(s.filter(":checked").length!==s.length,s);t._trigger("optgrouptoggle",i,{inputs:s.get(),label:a.parent().text(),checked:s[0].checked});i.preventDefault()}).end().delegate("label","mouseenter",function(){if(!e(this).hasClass("ui-state-disabled")){t.labels.removeClass("ui-state-hover");e(this).addClass("ui-state-hover").find("input").focus()}}).delegate("label","keydown",function(i){switch(i.keyCode){case 9:case 27:t.close();break;case 38:case 40:case 37:case 39:t._traverse(i.keyCode,this);i.preventDefault();break;case 13:i.preventDefault();e(this).find("input").trigger("click");break}}).delegate(":checkbox, :radio","click",function(i){var a=e(this),s=this.value,r=this.checked,n=t.element.find("option");if(a.is(":disabled")||t._trigger("click",i,{value:s,text:this.title,checked:r})===false){i.preventDefault();return}if(!t.options.multiple){n.not(function(){return this.value===s}).removeAttr("selected")}n.filter(function(){return this.value===s}).attr("selected",r?"selected":"");t.update(!i.originalEvent?r?-1:1:0)});e(document).bind("click.multiselect",function(i){var a=e(i.target);if(t._isOpen&&!a.closest("div.ui-multiselect-menu").length&&!a.is("button.ui-multiselect")){t.close()}});this.element.closest("form").bind("reset",function(){setTimeout(function(){t.update()},1)})},_setWidths:function(){var e=this._setButtonWidth();this._setMenuWidth(e)},_setButtonWidth:function(){var t=parseInt(this.element.outerWidth(),10),i=t?t:e(this.element).dr.computedWidth(),a=this.options,s=a.iconWidth?i-a.iconWidth:i;this.button.width(i);this.button.find("span").eq(0).css({width:s+"px",display:"inline-block"});return i},_setMenuWidth:function(e){var t=this.menu,i=(e||this.button.outerWidth())-parseInt(t.css("padding-left"),10)-parseInt(t.css("padding-right"),10)-parseInt(t.css("border-right-width"),10)-parseInt(t.css("border-left-width"),10);t.width(i)},_traverse:function(t,i){var a=e(i),s=this.menu.find("li").index(a.parent()),r=this.labels.length-1,n=t===38?"up":t===40?"down":0,o=n==="up"?s===0?0:s-1:s<r?s+1:r,l=a.text();this.menu.find("label").eq(o).trigger("mouseover")},_toggleChecked:function(t,i){var a=i&&i.length?i:this.labels.find("input");a.not(":disabled").attr("checked",t?"checked":"");this.update();var s=a.map(function(){return this.value}).get();var r=this.element.find("option").filter(function(){return!this.disabled&&e.inArray(this.value,s)>-1}).attr("selected",t?"selected":"")},_toggleDisabled:function(e){this.button.attr("disabled",e?"disabled":"")[e?"addClass":"removeClass"]("ui-state-disabled");this.menu.find("input").attr("disabled",e?"disabled":"").parent()[e?"addClass":"removeClass"]("ui-state-disabled");this.element.attr("disabled",e?"disabled":"")},update:function(t){if(typeof t==="undefined"){t=0}var i=this.options,a=this.labels.not(".ui-multiselect-all").find("input").not('[name="ui-multiselect-all"]'),s=a.length,r=a.filter(":checked"),n=r.length+t,o=this.button.outerHeight(),l,d=[],c,u;if(n===0){u=i.noneSelectedText}else{if(e.isFunction(i.selectedText)){u=i.selectedText.call(this,n,a.length,r.get())}else if(/\d/.test(i.selectedList)&&i.selectedList>0&&n<=i.selectedList){u=r.map(function(){return this.title}).get().join(", ")}else{u=i.selectedText.replace("#",n).replace("#",a.length)}}this.labels.find("input:checked").not('[name="ui-multiselect-all"]').each(function(){d.push(this.title)});c=d.length?d.join(", "):i.noneSelectedText;this.buttonlabel.html(c);l=this.button.outerHeight();if(l>o){while(this.button.outerHeight()>o){d.pop();this.buttonlabel.html(d.join(", ")+"...")}}this.button.attr("title",c);return c},open:function(t){var i=this,a=this.button,s=this.menu,r=this.speed,n=this.options,o=this.menu.outerHeight(true),l=o<n.maxHeight?o:n.maxHeight;if(this._trigger("beforeopen")===false||a.hasClass("ui-state-disabled")||this._isOpen){return}e(":dr-multiselect").not(this.element).each(function(){var t=e(this);if(t.multiselect("isOpen")){t.multiselect("close")}});var d=s.find("ul:last"),c=n.show,u=a.position();if(e.isArray(n.show)){c=n.show[0];r=n.show[1]||i.speed}d.scrollTop(0).height(l);if(e.ui.position&&!e.isEmptyObject(n.position)){n.position.of=n.position.of||a;s.show().position(n.position).hide().show(c,r)}else{s.css({top:u.top+a.outerHeight(),left:u.left}).show(c,r)}this.labels.eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus");this._isOpen=true;this._trigger("open")},close:function(){if(this._trigger("beforeclose")===false){return}var t=this,i=this.options,a=i.hide,s=this.speed,r=this.menu;if(e.isArray(i.hide)){a=i.hide[0];s=i.hide[1]||this.speed}r.hide(a,s).find(".ui-state-hover").removeClass("ui-state-hover");this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave");this.update();this._trigger("close");this._isOpen=false},enable:function(){this._toggleDisabled(false)},disable:function(){this._toggleDisabled(true)},checkAll:function(e){this._toggleChecked(true);this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(false);this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter(":checked")},destroy:function(){e.Widget.prototype.destroy.call(this);this.button.remove();this.menu.remove();this.element.show();return this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},_setOption:function(t,i){var a=this.menu;switch(t){case"header":a.find("div.ui-multiselect-header")[i?"show":"hide"]();break;case"checkAllText":a.find("a.ui-multiselect-all span").eq(-1).text(i);break;case"uncheckAllText":a.find("a.ui-multiselect-none span").eq(-1).text(i);break;case"height":a.find("ul:last").height(parseInt(i,10));break;case"minWidth":this.options[t]=parseInt(i,10);this._setButtonWidth();this._setMenuWidth();break;case"selectedText":case"selectedList":case"noneSelectedText":this.options[t]=i;this.update();break;case"classes":a.add(this.button).removeClass(this.options.classes).addClass(i);break}e.Widget.prototype._setOption.apply(this,arguments)}})})(jQuery);